//Conversations
var leftConversation1 = ["Miss *** that smile.",
  "North Hollywood, and you?",
  "That's not crazy far! Where are you moving to?",
  "I'm in music, I am in a band with my two brothers, we tour pretty often so I'm not home a lot, but I am here for the next few months which is nice. And you?",
  "Amazing congrats! Hurry up and move here. It's similar to Maroon 5, but a little more urban if that makes any sense lol",
  "  ",
  "  ",
  "  ",
  "  ",
  "  "
]; //Boy

var rightConversation1 = ["Hehe. Where do you live?",
  "Encino! But hoping to move soon",
  "Yea it's not too far! I think I want to move to West Hollywood. Gonna start looking for apartments soon! What do you do?",
  "That's amazing! What kind of music do you guys play? I start working for Oracle next month. I'm really excited",
  "   ",
  "   ",
  "  ",
  "  ",
  "  ",
  "   "
]; //Girl

var leftConversation2 = ["Where are you from?",
  "I can't wait. I'm from LA too! Where in LA do you live?",
  "I was in Agoura earlier today! But I live in Encino. Hopefully moving soon though.",
  "Haha yup the valley live. Do you live with your parents?",
  "Oh ok! Did you go to Calabasas High? Yea in June!",
  "No but I have friends that did! I went to Campbell Hall",
  "Yea! I have a few friends in Brentwood and some in West Hollywood/Beverly Hills. I can't wait until I move you",
  "Sorry I'm just seeing your response! I got dinner with my friend and got a good nights sleep haha. What are your plans for the weekend?",
  "   ",
  "   "
]; //Girl

var rightConversation2 = ["The 3 day weekend. I'm from LA, what about you?",
  "We are twins! I live in Brentwood, what about you? You're in Agoura?",
  "Oh I work in Woodland Hills and I'm from Calabasas so I know about the valley life",
  "No my parents live in Hidden Hills, I live in Brentwood with my buddies. You just move back from college?",
  "I did go to CHS, did you?",
  "Ahh yes cause you lived in Encino. Do you have friends that live out the Westside by me?",
  "Movin on out. What are you doing tonight?",
  "   ",
  "   ",
  "   "
]; //Boy

var leftConversation3 = ["Hey *** you're a Gaucho! How's your night going?",
  "Yep! I live in Mar Vista how about you?",
  "What do you do for work?",
  "Wow nice, political science major? I do advertising for Apple and Apple Music",
  "Nice I was a comm major, I took a global studies class and love it though. It was global disapora. What do you have going on this weekend?",
  "Same I'm going out tomorrow. What are you up to Saturday night? I'm down to get drinks",
  "  ",
  "  ",
  "  ",
  "  "
]; //Boy

var rightConversation3 = ["Yes you also went to UCSB!! Where do you live?",
  "Oh okay not too far from me. I live in Encino",
  "I work for a state assembly member. How about you?",
  "Global studies but it's so similar. Oh no way. That's really cool. What did you study at UCSB?",
  "Oh really! I don't think I ever took that class but I loved global studies. I think I'm going out with some friends tomorrow night but thats about it. How about you?",
  "I have no plans as of now. I'm down to get drinks!",
  "  ",
  "  ",
  "   ",
  "   "
]; //Girl

var leftConversation4 = ["Hello there, how are you doing? I love your name, bad ass haha",
  "I'm doing fantastic, out with some friends on a small road trip vacation. I genuinely think I had the greatest weekend of this year so far haha. Sad to leave tomorrow but ready for my own bed haha. How was your weekend?",
  "That's awesome! We both had good weekends. Gotta keep the trend going for this month haha. And good morning to you :) I had to get up really early so we could drive back. And it's my shift at the wheel",
  "Dont worry! I survived haha. Oh man hopefully you can have some fun before you sleep :)",
  "Oh no!! Not much time for sleep hahah, sleep is definitely still a win though",
  "No passed out hard after that drive haha",
  "Let me get your number then :)",
  "  ",
  "  ",
  "  "
]; //Boy

var rightConversation4 = ["Haha thank you! And I'm good. How are you?",
  "My weekend was actually really really good. I can't complain! I'm glad you had a great weekend as well. Good morning btw :)",
  "Ahhhhh i hope you survived your shift at the wheel! I had a super busy Monday man all I did was homework lol",
  "Haha I have to be up at 5 I'm not excited",
  "It definitely is lol",
  "Haha nice. Sorry for the lag I never get on here!!",
  "  ",
  "  ",
  "   ",
  "   "
]; //Girl

var leftConversation5 = ["Hey ***, how are you doing?",
  "I'm good just out with some friends. Where are you from?",
  "I'm from Tri Valley, across the bridge. Moved to LA though haha, guess we kinda swapped",
  "  ",
  "  ",
  "  ",
  "  ",
  "  ",
  "  ",
  "  "
]; //Boy

var rightConversation5 = ["Pretty good. How are you doing?",
  "I'm from Orange County. Hbu?",
  "Haha guess we did XD",
  "  ",
  "  ",
  "  ",
  "  ",
  "  ",
  "  ",
  "  "
]; //Girl

var leftConversation6 = ["Hey there, how you doing?",
  "Headed out tonight. What are you up to?",
  "What are you and your friends about to do?",
  "Well are you and your cute friends trying to do something eventful?",
  "Lame",
  "  ",
  "  ",
  "  ",
  "  ",
  "  "
]; //Boy

var rightConversation6 = ["good haha I've been busy af. I'm in Colorado on vacation haha",
  "just with friends lol",
  "just hang out lol",
  "probably not",
  "I know right",
  "  ",
  "  ",
  "  ",
  "  ",
  "  "
]; //Girl

var leftConversation7 = ["Hey what's up",
  "Always been a Ravenclaw haha. Just out right now with a friend right now. How was your weekend?",
  "  ",
  "  ",
  "  ",
  "  ",
  "  ",
  "  ",
  "  ",
  "  "
]; //Boy

var rightConversation7 = ["I got sorted into ravrnclaw, but I've always thought myself to be a gryffendor. Nm, hbu?",
  "I probably have too judging by how much I like to read, just been in denile. Pretty lame, I have finals coming up. How was yours?",
  "  ",
  "  ",
  "  ",
  "  ",
  "  ",
  "  ",
  "  ",
  "  "
]; //Girl

var leftConversation8 = ["I'm out in California next month, any advice?",
  "We've got a place booked in West Hollywood and I've got a session out in Oakland for a couple nights",
  "Amazing! I'll definitely check those out. Thank you :) So what made you give up sunny California for gloomy London?",
  "Fair enough, how long are you here for? I'm going for music, got a few writing sessions and meetings",
  "Oh right so you're planning on staying for a while. Where abouts are you staying?",
  "Ah that's a dope area! I'm down in ***. Do you usually have weekends off, do you wanna grab a drink sometime?",
  "Ah that's perfect then! How's Friday sound?",
  "Awesome. Gimmie your number and I'll drop you a text sometime on Friday :)",
  "  ",
  "  "
]; //Boy

var rightConversation8 = ["Hmm. What part of California will you be in?",
  "Well I'm from the Bay Area so can give ya some recommendations there. West Hollywood, hm. Oh, adults only is a really sick speakeasy.",
  "Grad school. I got into *** and figured why not haha. What are you doing out in California? Just decided to take a visit?",
  "Have another year left on my visa but I've been applying to jobs. Ah okay. California is a great place for that for sure haha",
  "Yea, that's the idea haha. I'm moving to ***. How about you?",
  "Haha I live in *** right now. I do. Yea, I'm up for it (:",
  "Friday works for me (:",
  "*** Sounds good (:",
  "  ",
  "  "
]; //Girl

var leftConversation9 = ["Mademoiselle. How are you this fine Saturday?",
  "Similarly, taking the pup for a walk. I've just returned from South America, so it's the simple things in life...What kind of dog do you have?",
  "Just traveling around the continent for the past 5 months. Was pretty great but feels weird being back. Golden retriever, of course :)",
  "Awesome. You're gonna have an amazing time. Just to study?",
  "Hah. Yeah it's good to get out. And Florence is an amazing city. You in school here?",
  "Nono, I'm a grandpa. I live in NY. Just in town for a few days to help my parents move on my way back from South America",
  "Yea it's the best. So this will have to be a short but furious romance ;)",
  "You'd be surprised. I'm a writer. And you? What do you study?",
  "Well then. With two artistes involved, it will almost assuredly be romantic, and almost certainly furious...So what are your plans for later?",
  "Well I was hoping to meet a charming young photographer for a drink"
]; //Boy

var rightConversation9 = ["Hello (: Well, thank you. Just relaxing with my dog. How about yourself?",
  "That's exciting. What were you doing there? I have a little Pomeranian mix. He's a rescue and they didn't know much about it when I adopted him. What kind of dog do you have?",
  "Oh wow. You were gone for a while haha. I woul dimagine that being weird. I'm about to go through the same thing. I'm heading over to London and then staying in Florence for like 4 months. Aw! Golden retrievers are adorable.",
  "I hope so! I'm nervous. Mhm. I figured I'd try it out since I've lived in California my entire life haha.",
  "Very true. I fell in love with it when I went about 2 years back. Mhm. I go to UCSB. Are you in school?",
  "Ah, I see. NY is amazing. I'm hoping to move there for grad school in a year.",
  "What do you do in NY? Hahahahaha a few days, huh. Idk how much of a romance that could be (;",
  "I'd like to think I may be (; oh, nice! A fellow artist. Haha. I'm an art major and an art history minor. Photographer and digital/visual artist.",
  "Hahahahahahaha you have something there. I'm not sure yet. How about you?",
  "  "
]; //Girl

//Conversations Array and Current Conversation Index
var conversations = new Array(); //Array of conversation objects
var currentConversation = 0; //Current conversation index 

//Used for swipping (Using the app BetterTouchTool I have converted swipes into keyPressed to execute the swipping gesture)
var value = 0;

//Speech
var speaking = false;
var leftSpeaking = false;

//Male Conversation Speech
var maleVoice = new p5.Speech('Google UK English Male'); //New P5.Speech object

//Female Conversation Speech
var femaleVoice = new p5.Speech('Google UK English Female'); //New P5.Speech object

function setup() {
  createCanvas(windowWidth, windowHeight); //This will need to be fullScreen

  //Text (for conversation title)  
  textFont("Verdana");
  textSize(15);
  textAlign(CENTER);
  smooth();

  //Create a new Conversation and send it conversations, conversation colors, and voices
  append(conversations, new Conversation("Boy Band", leftConversation1, rightConversation1, maleVoice, femaleVoice)); //Conversation 1
  append(conversations, new Conversation("'We are twins!'", leftConversation2, rightConversation2, femaleVoice, maleVoice)); //Conversation 2
  append(conversations, new Conversation("Gauchos", leftConversation3, rightConversation3, maleVoice, femaleVoice)); //Conversation 3
  append(conversations, new Conversation("Good Weekends", leftConversation4, rightConversation4, maleVoice, femaleVoice)); //Conversation 4
  append(conversations, new Conversation("Swapped", leftConversation5, rightConversation5, maleVoice, femaleVoice)); //Conversation 5
  append(conversations, new Conversation("Maybe another night?", leftConversation6, rightConversation6, maleVoice, femaleVoice)); //Conversation 6
  append(conversations, new Conversation("Ravenclaw vs. Gryffendor", leftConversation7, rightConversation7, maleVoice, femaleVoice)); //Conversation 7
  append(conversations, new Conversation("Neighbors?", leftConversation8, rightConversation8, maleVoice, femaleVoice)); //Conversation 8
  append(conversations, new Conversation("'Well then, a walk on the beach'", leftConversation9, rightConversation9, maleVoice, femaleVoice)); //Conversation 9

  //Enable Gestures
  Gestures();
}

function draw() {
  background(255);

  //Conversations
  conversations[currentConversation].update();
  conversations[currentConversation].draw();
}

function Gestures() {
  var options = { //Set options to prevent default behaviors for swipe, pinch, etc. (https://github.com/hammerjs/hammer.js/wiki/Tips-&-Tricks#best-practices)
    preventDefault: true,
    dragLockToAxis: true,
    dragBlockHorizontal: true
  };

  var hammer = new Hammer(document.body, options); //Document.body registers gestures anywhere on the page

  hammer.on("doubletap", function(event) { //Double tap 
    conversations[currentConversation].saySomething(); //Say current conversation 
  });
}

function keyPressed() { //Using the program BetterTouchTool, swipes are converted into keyPressed to create the correct swipping animation with an Apple Magic Touchpad
  if (keyCode === RIGHT_ARROW) { //Right Swipe
    conversations[currentConversation].nextInConversation(); //Next pair of ellipses fill static position
  }

  if (keyCode === LEFT_ARROW) { //Left Swipe
    currentConversation++ //New conversation 
    if (currentConversation >= conversations.length) { //Loops back through conversations when the program has reached the last conversation
      currentConversation = 0;
    }
  }
}

function Conversation(title, leftMessages, rightMessages, leftVoice, rightVoice) { //https://github.com/processing/p5.js/wiki/JavaScript-basics#using-parameters for how to make classes and constructors
  this.title = title; //Conversation Title
  this.leftMessages = leftMessages; //Left Messages
  this.rightMessages = rightMessages; //Right Messages
  this.leftVoice = leftVoice; //Left Voice
  this.rightVoice = rightVoice; //Right Voice

  //Check to make sure all the conversations have the same amount of messages in the array (10)
  if (this.leftMessages.length != this.rightMessages.length) {
    //LEFT AND RIGHT MESSAGES MUST BE THE SAME LENGTH, SO ERROR MESSAGE
    console.log("BIG TROUBLE! LEFT AND RIGHT MESSAGES MUST BE THE SAME LENGTH")
  }

  //Text Colour
  this.leftColour = color(random(255), random(255), random(255)); //Left colour is random to make each ellipise gender ambiguous on the start 
  this.rightColour = color(random(255), random(255), random(255)); //Right colour is random to make each ellipise gender ambiguous on the start

  //Positions and Velocities
  this.leftPositions = new Array(this.leftMessages.length);
  this.leftVelocities = new Array(this.leftMessages.length);
  this.rightPositions = new Array(this.rightMessages.length);
  this.rightVelocities = new Array(this.rightMessages.length);

  //Left and Right Static Messages 
  this.staticMessage = 0;
  this.staticLeftPosition = createVector(random(0, (width / 3) - 400), random(100, height / 2 - 200));
  this.staticRightPosition = createVector(random(width / 2, width * (2 / 3) - 200), random((100, height / 3) - 200));

  //Images of Messages 
  this.imagesOfLeftMessages = new Array(this.leftMessages.length);
  this.imagesOfRightMessages = new Array(this.leftMessages.length);

  for (var i = 0; i < this.leftMessages.length; i++) { //For all the messages in the array (We use this.leftMessages because all arrays are the same length)  
    //Assigns Random Positions and Velocities to All Left Messages
    this.leftPositions[i] = createVector(random(width / 2), random(height / 2));
    this.leftVelocities[i] = createVector(random(1, 5), random(1, 5));

    //Assigns Random Positions and Velocities to All Right Messages
    this.rightPositions[i] = createVector(random(width / 2), random(height / 2));
    this.rightVelocities[i] = createVector(random(1, 5), random(1, 5));

    //Get the Current Message
    this.currentLeftMessage = this.leftMessages[i];
    this.currentRightMessage = this.rightMessages[i];

    this.arcLength = 0; //Keeps track of our position along the curve
    this.isStatic = (this.staticMessage == i); //Get the current static message

    //Get the Width (Length) of Each Message
    this.widthOfLeftMessage = textWidth(this.currentLeftMessage);
    this.widthOfRightMessage = textWidth(this.currentRightMessage);

    //Radius of Each Message
    this.radiusOfLeftMessage = (this.widthOfLeftMessage + 5) / (TWO_PI); //Equation for radius of left message, 5 is added for a bit of padding
    this.radiusOfRightMessage = (this.widthOfRightMessage + 5) / (TWO_PI); //Equation for radius of right message, 5 is added for a bit of padding

    //Create Left Graphics
    this.imagesOfLeftMessages[i] = createGraphics(this.radiusOfLeftMessage * 4, this.radiusOfLeftMessage * 4); //Radius is multiplied to find the width and height of the image
    this.imagesOfLeftMessages[i].pixelDensity(1); //Scales graphic to the right size since createGraphic() scales the image
    this.imagesOfLeftMessages[i].translate(this.imagesOfLeftMessages[i].width / 2, this.imagesOfLeftMessages[i].height / 2); //Translates image to fit within the graphic at the center

    //Create Right Graphics
    this.imagesOfRightMessages[i] = createGraphics(this.radiusOfRightMessage * 4, this.radiusOfRightMessage * 4); //Radius is multiplied to find the width and height of the image
    this.imagesOfRightMessages[i].pixelDensity(1); //Scales graphic to the right size since createGraphic() scales the image
    this.imagesOfRightMessages[i].translate(this.imagesOfRightMessages[i].width / 2, this.imagesOfRightMessages[i].height / 2); //Translates image to fit within the graphic at the center

    //Conversation Graphic Background
    this.imagesOfLeftMessages[i].background(255, 255, 255, 0); //White background with an alpha to make the graphic's background transparent
    this.imagesOfRightMessages[i].background(255, 255, 255, 0); //White background with an alpha to make the graphic's background transparent

    //Left Conversation Text Attributes
    this.imagesOfLeftMessages[i].textFont('Verdana', 15); //Left message font type and size
    this.imagesOfLeftMessages[i].textAlign(CENTER); //Left message text align center
    this.imagesOfLeftMessages[i].smooth(); //Left message text smooth

    //Right conversation Text Attributes
    this.imagesOfRightMessages[i].textFont('Verdana', 15); //Right message font type and size
    this.imagesOfRightMessages[i].textAlign(CENTER); //Right message text align center
    this.imagesOfRightMessages[i].smooth(); //Right message text smooth

    //Current Left Message - Refrence: https://processing.org/tutorials/text/
    for (var j = 0; j < this.currentLeftMessage.length; j++) { //For each message individually (which ever message is currently in the loop)
      this.currentCharacter = this.currentLeftMessage.charAt(j); //Current character of the current message (which ever message is currently in the loop)
      this.characterWidth = textWidth(this.currentCharacter); //Gets the width (length) of each character

      this.arcLength += this.characterWidth / 2; //Move along the arc, half the width of the character at a time
      this.theta = PI + this.arcLength / this.radiusOfLeftMessage; //Theta (angle of change) is equal to PI (offset) + arclength

      this.imagesOfLeftMessages[i].push();
      this.imagesOfLeftMessages[i].translate(this.radiusOfLeftMessage * cos(this.theta), this.radiusOfLeftMessage * sin(this.theta));
      this.imagesOfLeftMessages[i].rotate(this.theta + HALF_PI); //Rotates each letter accordingly around ellipse to create a more fluid circle 
      this.imagesOfLeftMessages[i].fill(red(this.leftColour), green(this.leftColour), blue(this.leftColour), 100); //Gives each ellipse the color assigned during setup and initialization of the class 
      this.imagesOfLeftMessages[i].text(this.currentCharacter, 0, 0);
      this.imagesOfLeftMessages[i].pop();

      this.arcLength += this.characterWidth / 2; //Move along the arc, half the width of the character at a time
    }

    //Current Right Message - Refrence: https://processing.org/tutorials/text/ 
    for (var k = 0; k < this.currentRightMessage.length; k++) { //For each message individually (which ever message is currently in the loop)
      this.currentCharacter = this.currentRightMessage.charAt(k); //Current character of the current message (which ever message is currently in the loop)
      this.characterWidth = textWidth(this.currentCharacter); //Gets the width (length) of each character

      this.arcLength += this.characterWidth / 2; //Move along the arc, half the width of the character at a time
      this.theta = PI + this.arcLength / this.radiusOfRightMessage; //Theta (angle of change) is equal to PI (offset) + arclength

      this.imagesOfRightMessages[i].push();
      this.imagesOfRightMessages[i].translate(this.radiusOfRightMessage * cos(this.theta), this.radiusOfRightMessage * sin(this.theta));
      this.imagesOfRightMessages[i].rotate(this.theta + HALF_PI); //Rotates each letter accordingly around ellipse to create a more fluid circle 
      this.imagesOfRightMessages[i].fill(red(this.rightColour), green(this.rightColour), blue(this.rightColour), 100); //Gives each ellipse the color assigned during setup and initialization of the class 
      this.imagesOfRightMessages[i].text(this.currentCharacter, 0, 0);
      this.imagesOfRightMessages[i].pop();

      this.arcLength += this.characterWidth / 2; //Move along the arc, half the width of the character at a time
    }
  }

  //Speech
  this.saySomething = function() {
    if (!speaking) { //If nothing is being said, say left message
      this.leftVoice.speak(this.leftMessages[this.staticMessage]);
    }
    if (!leftSpeaking) { //If left message isn't being said, say right message 
      this.rightVoice.speak(this.rightMessages[this.staticMessage])
    }
  }

  this.nextInConversation = function() { //When right swipe, next message in conversation
    this.staticMessage++; //Increment
    if (this.staticMessage >= this.leftMessages.length) {
      this.staticMessage = 0; //If it's too long, reset to 0
    }
  }

  this.previousInConversation = function() { //When left swipe, filter in new conversation
    this.staticMessage--; //Decrement
    if (this.staticMessage < 0) {
      this.staticMessage = this.leftMessages.length - 1; //-1 because we number from 0 AND we use this.leftMessages because both arrays are the same length
    }
  }

  //Animation
  this.update = function() { //Adds the positions and the velocities together to get animation for all messages
    for (var i = 0; i < this.leftMessages.length; i++) { //We use this.leftMessages because both arrays are the same length  
      if (i != this.staticMessage) { //If the message is not static we need to animate it around the screen
        this.leftPositions[i].add(this.leftVelocities[i]); //Add the velocity to the position to move it correctly on this frame
        this.rightPositions[i].add(this.rightVelocities[i]); //Add the velocity to the position to move it correctly on this frame

        if (this.leftPositions[i].x > width || this.leftPositions[i].x < -500 || this.rightPositions[i].x > width || this.rightPositions[i].x < -500) {
          //If the x position is to the left of the screen or to the right, flip the velocity so that it bounces back into view
          this.leftVelocities[i].x *= -1;
          this.rightVelocities[i].x *= -1;
        }

        if (this.leftPositions[i].y > height || this.leftPositions[i].y < 0 || this.rightPositions[i].y > height || this.rightPositions[i].y < 0) {
          //If the y position is to the top of the screen or to the bottom, flip the velocity so that it bounces back into view
          this.leftVelocities[i].y *= -1;
          this.rightVelocities[i].y *= -1;
        }

      } else {
        //It is the static message, position in the middle of the screen
        this.leftPositions[i].x = this.staticLeftPosition.x;
        this.leftPositions[i].y = this.staticLeftPosition.y;

        this.rightPositions[i].x = this.staticRightPosition.x;
        this.rightPositions[i].y = this.staticRightPosition.y;
      }
    }
  }

  //Draw
  this.draw = function() {
    //Conversation Title
    fill((red(this.leftColour) + red(this.rightColour)) / 2, (green(this.leftColour) + green(this.rightColour)) / 2, (blue(this.leftColour) + blue(this.rightColour)) / 2); //Conversation title colour
    text(this.title, width / 2, height / 2);

    //Draw Message Graphic
    for (var i = 0; i < this.leftMessages.length; i++) { //For all the messages in an array (We use this.leftMessages because all arrays are the same length)  
      //Left Message Graphic
      image(this.imagesOfLeftMessages[i], this.leftPositions[i].x, this.leftPositions[i].y);

      //Right Message Graphic
      image(this.imagesOfRightMessages[i], this.rightPositions[i].x, this.rightPositions[i].y);
    }
  }
}